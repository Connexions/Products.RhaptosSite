<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      tal:omit-tag="">
<dl class="portlet portletWorkflowReview"
    i18n:domain="plone">

  <dt class="portletHeader">
    <span class="portletTopLeft"></span>
    <a href="#"
       class="tile"
       i18n:translate=""
       tal:content="view/title" />
    <span class="portletTopRight"></span>
  </dt>

  <dd class="portletItem odd"
      tal:define="portal_url context/portal_url;">
    <p tal:define="newlensmacro context/lens_folder_view/macros/newlens | nothing"
       tal:condition="newlensmacro">
      <metal:macro metal:use-macro="newlensmacro">
	Create a new lens
      </metal:macro>
    </p>
    <ul class="lenses"
	tal:define="l_tool context/lens_tool;
                    lenses_raw l_tool/getRecentlyModifiedListsOwned | python:[];
                    lenses python:lenses_raw[:5];
                    lenses_count python:len(lenses_raw)">
      <li class="favorites">
	<a href="#"
	   i18n:translate="link_my_favorites"
           tal:attributes="href string:$portal_url/go_favorites/view">My Favorites</a>
	(<a href="#"
	    i18n:translate="link_edit"
            tal:attributes="href string:$portal_url/go_favorites/contents">edit</a>)
      </li>
      <tal:div tal:condition="lenses" tal:repeat="lens lenses">
	<li class="lens"
            tal:define="lname lens/getDisplayName | nothing;
			url lens/getURL">
          <a tal:attributes="href string:${url}">
            <span tal:define="displayName lname | nothing"
                  tal:replace="python:displayName">lens name</span>
          </a>
          <img src="/private.gif"
               tal:condition="python:lens.review_state=='private'"
               tal:replace="structure context/private.gif">
            (<a tal:attributes="href string:${url}/contents">edit</a>)
	</li>
      </tal:div>
      <li class="more" tal:condition="python:len(lenses_raw) > 5">
	<a href="#"
           i18n:translate="more"
           tal:define="ltool context/lens_tool;
                       lenses ltool/getListsOwned;
                       lensfolder python:ltool.getIndividualFolder(create=False)"
           tal:omit-tag="not:lenses"
           tal:attributes="href lensfolder/absolute_url | string:#">More &#187;</a>
      </li>
    </ul>
    <ul 
       tal:define="lensorganizers context/@@lensorganizers|nothing;
                   isSiyavulaMember context/@@siyavula-account|nothing;
                   member python:here.portal_membership.getAuthenticatedMember().getId();
                   isTestMember python:member.lower().startswith('siyavulatest')" 
       tal:condition="python:isSiyavulaMember or isTestMember">
      <li>
	<a href="/lenses/create_lensorganizer"
	   i18n:translate="link_create_lensorganizer"
           tal:attributes="href string:$portal_url/lenses/create_lens_organizer">Create a new lens organizer</a>
      </li>
      <tal:comment tal:condition="nothing">Only show list item if member's lensfolder exists</tal:comment>
      <li  tal:define="ltool context/lens_tool;
                       lenses ltool/getListsOwned;
                       lensfolder python:ltool.getIndividualFolder(create=False);
                       organizers python:context.restrictedTraverse('@@lensorganizers')(member_only=True) or None;
                       lensorganizers python:organizers and [b.getObject() for b in organizers] or [];"
           tal:condition="python:lensfolder is not None and len(lensorganizers) > 0">
	<tal:comment tal:condition="nothing">Only show "View all my lens organizers" link if member has any lens organizers</tal:comment>
	<a tal:attributes="href string:${lensfolder/absolute_url}/lensorganizer_listing" 
           tal:condition="nocall:lensorganizers" href="#">
          <span style="color:grey; text-decoration:underline;"
		tal:attributes="style python:not lenses and default or None"
		i18n:translate="link_view_lens_organizers">
            View all my lens organizers</span>
	</a>
      </li>
    </ul>
  </dd>
</dl>
</html>
